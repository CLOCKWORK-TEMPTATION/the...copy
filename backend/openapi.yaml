openapi: 3.0.0
info:
  title: The Copy API
  version: 1.0.0
  description: |
    # The Copy API Documentation

    The Copy is a comprehensive platform for Arabic drama script analysis and cinematography planning.

    ## Features
    - **AI-Powered Analysis**: Seven-station pipeline for comprehensive script analysis
    - **Authentication**: JWT-based secure authentication
    - **Directors Studio**: Project and scene management for filmmakers
    - **Cinematography Tools**: Shot planning and visual storytelling

    ## Authentication
    Include the JWT token in the Authorization header:
    ```
    Authorization: Bearer YOUR_JWT_TOKEN
    ```

servers:
  - url: http://localhost:3001
    description: Development server
  - url: https://api.the-copy.com
    description: Production server

tags:
  - name: Health
    description: Health check endpoints for monitoring API availability and status
  - name: Authentication
    description: User authentication and authorization endpoints including signup, login, and session management
  - name: Analysis
    description: AI-powered script analysis using the seven-station pipeline for comprehensive dramatic analysis
  - name: Projects
    description: Project management endpoints for creating, reading, updating, and deleting screenplay projects
  - name: Scenes
    description: Scene management endpoints for organizing and tracking individual scenes within projects
  - name: Characters
    description: Character tracking endpoints for managing character information and relationships
  - name: Shots
    description: Shot planning endpoints for cinematography and visual storytelling preparation

paths:
  /api/health:
    get:
      tags:
        - Health
      summary: Health check
      description: Check if the API is running
      responses:
        '200':
          description: API is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  status:
                    type: string
                    example: ok
                  timestamp:
                    type: string
                    format: date-time
                  version:
                    type: string
                    example: "1.0.0"
                  uptime:
                    type: number
                    example: 123.45

  /api/auth/signup:
    post:
      tags:
        - Authentication
      summary: Create new user account
      description: Register a new user with email and password
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
                password:
                  type: string
                  format: password
                  minLength: 8
                  example: SecurePassword123
                firstName:
                  type: string
                  example: أحمد
                lastName:
                  type: string
                  example: محمد
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      accessToken:
                        type: string
                        example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                      user:
                        $ref: '#/components/schemas/User'
        '400':
          description: Validation error or user already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '429':
          $ref: '#/components/responses/RateLimitError'

  /api/auth/login:
    post:
      tags:
        - Authentication
      summary: Login to account
      description: Authenticate user and receive JWT token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
                password:
                  type: string
                  format: password
                  example: SecurePassword123
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      accessToken:
                        type: string
                      user:
                        $ref: '#/components/schemas/User'
        '401':
          description: Invalid credentials
        '429':
          $ref: '#/components/responses/RateLimitError'

  /api/auth/logout:
    post:
      tags:
        - Authentication
      summary: Logout from account
      description: Invalidate current session and clear authentication token
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: تم تسجيل الخروج بنجاح
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/auth/me:
    get:
      tags:
        - Authentication
      summary: Get current user
      description: Get authenticated user information
      security:
        - bearerAuth: []
      responses:
        '200':
          description: User information
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/analysis/seven-stations:
    post:
      tags:
        - Analysis
      summary: Run Seven Stations analysis pipeline
      description: |
        Comprehensive AI-powered script analysis using seven analytical stations:
        1. Structure Analysis
        2. Character Development
        3. Dialogue Quality
        4. Theme Exploration
        5. Pacing & Rhythm
        6. Visual Storytelling
        7. Emotional Impact
        
        Note: This is a long-running operation that may take 30-60 seconds.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - text
              properties:
                text:
                  type: string
                  description: Full screenplay text in Arabic or English
                  example: "FADE IN:\n\nEXT. PARK - DAY\n\n..."
                  minLength: 100
                  maxLength: 100000
      responses:
        '200':
          description: Analysis completed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    description: Analysis results from all seven stations
                    properties:
                      structure:
                        type: object
                        description: Structural analysis results
                      characters:
                        type: object
                        description: Character development analysis
                      dialogue:
                        type: object
                        description: Dialogue quality assessment
        '400':
          description: Invalid input - text too short or malformed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '429':
          $ref: '#/components/responses/RateLimitError'
        '500':
          description: AI service error or internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/projects:
    get:
      tags:
        - Projects
      summary: Get all projects
      description: |
        Retrieve all screenplay projects for the authenticated user.
        Results are sorted by most recently updated first.
        Supports pagination via query parameters.
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: limit
          schema:
            type: integer
            default: 50
            minimum: 1
            maximum: 100
          description: Maximum number of projects to return
        - in: query
          name: offset
          schema:
            type: integer
            default: 0
            minimum: 0
          description: Number of projects to skip for pagination
      responses:
        '200':
          description: Projects list retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Project'
                  total:
                    type: integer
                    description: Total number of projects
                    example: 42
        '401':
          $ref: '#/components/responses/UnauthorizedError'

    post:
      tags:
        - Projects
      summary: Create new project
      description: Create a new screenplay project with title and optional script content
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
              properties:
                title:
                  type: string
                  description: Project title
                  example: مشروع فيلم جديد
                  minLength: 1
                  maxLength: 200
                scriptContent:
                  type: string
                  description: Initial screenplay content (optional)
                  example: "FADE IN:\n\nEXT. DESERT - DAY"
      responses:
        '201':
          description: Project created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Project'
        '400':
          description: Validation error - invalid title or content
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/projects/{id}:
    get:
      tags:
        - Projects
      summary: Get project by ID
      description: Retrieve detailed information for a specific project including scenes and characters
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: Unique project identifier
          example: 550e8400-e29b-41d4-a716-446655440000
      responses:
        '200':
          description: Project details retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Project'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'

    put:
      tags:
        - Projects
      summary: Update project
      description: Update project title, script content, or other metadata
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: Unique project identifier
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                  description: Updated project title
                  minLength: 1
                  maxLength: 200
                scriptContent:
                  type: string
                  description: Updated screenplay content
      responses:
        '200':
          description: Project updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Project'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'

    delete:
      tags:
        - Projects
      summary: Delete project
      description: |
        Permanently delete a project and all associated data (scenes, shots, characters).
        This action cannot be undone.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: Unique project identifier
      responses:
        '200':
          description: Project deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: تم حذف المشروع بنجاح
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    Error:
      type: object
      required:
        - success
        - error
      properties:
        success:
          type: boolean
          example: false
          description: Always false for error responses
        error:
          type: string
          description: Human-readable error message in Arabic or English
          example: حدث خطأ في معالجة الطلب
        details:
          type: array
          description: Additional error details (validation errors, etc.)
          items:
            type: object
            properties:
              field:
                type: string
              message:
                type: string

    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        firstName:
          type: string
        lastName:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Project:
      type: object
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        scriptContent:
          type: string
        userId:
          type: string
          format: uuid
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

  responses:
    UnauthorizedError:
      description: |
        Unauthorized - Authentication required or token invalid/expired.
        غير مصرح - يرجى تسجيل الدخول أو تجديد الرمز
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            success: false
            error: غير مصرح - يرجى تسجيل الدخول

    NotFoundError:
      description: |
        Resource not found or user does not have access.
        المورد غير موجود أو ليس لديك صلاحية الوصول
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            success: false
            error: المورد غير موجود

    RateLimitError:
      description: |
        Rate limit exceeded - too many requests.
        تم تجاوز الحد المسموح من الطلبات - يرجى المحاولة لاحقاً
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            success: false
            error: تم تجاوز الحد المسموح من الطلبات
      headers:
        X-RateLimit-Limit:
          schema:
            type: integer
          description: Maximum requests allowed per window
        X-RateLimit-Remaining:
          schema:
            type: integer
          description: Remaining requests in current window
        X-RateLimit-Reset:
          schema:
            type: integer
          description: Unix timestamp when rate limit resets
