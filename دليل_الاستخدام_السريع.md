# دليل الاستخدام السريع - نظام الوكيل الخلفي

## التهيئة الأولية

### 1. إضافة Provider في Root Layout

```tsx
// app/layout.tsx
import { BackgroundWorkersProvider } from "@/workers/BackgroundWorkersProvider";

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="ar" dir="rtl">
      <body>
        <BackgroundWorkersProvider>
          {children}
        </BackgroundWorkersProvider>
      </body>
    </html>
  );
}
```

## الاستخدام في الصفحات

### طريقة 1: استخدام المكون الجاهز

```tsx
// في أي صفحة
import { ScriptAnalysisPanel } from "@/components/ScriptAnalysis";

export default function MyPage() {
  return (
    <div className="container">
      <ScriptAnalysisPanel 
        scriptId="script-123"
        scriptContent="محتوى السيناريو هنا..."
      />
    </div>
  );
}
```

### طريقة 2: استخدام Hook مخصص

```tsx
"use client";
import { useScriptAnalysis } from "@/components/ScriptAnalysis";

export default function MyPage() {
  const { 
    analyzeScript, 
    isAnalyzing, 
    progress, 
    result 
  } = useScriptAnalysis();

  const handleAnalyze = async () => {
    const result = await analyzeScript(
      "script-id",
      "محتوى السيناريو",
      {
        timeout: 120000, // 2 دقيقة
        skipStations: ["station-6"], // تخطي محطات معينة
      }
    );
    
    console.log("النتائج:", result);
  };

  return (
    <div>
      <button onClick={handleAnalyze} disabled={isAnalyzing}>
        {isAnalyzing ? `التحليل جاري... ${progress}%` : "ابدأ التحليل"}
      </button>
      
      {result && (
        <div>
          <h3>النتائج جاهزة!</h3>
          <pre>{JSON.stringify(result, null, 2)}</pre>
        </div>
      )}
    </div>
  );
}
```

### طريقة 3: استخدام مباشر

```tsx
import { sevenStationsOrchestrator } from "@/orchestration/pipeline-orchestrator";

async function analyzeMyScript(scriptId: string, content: string) {
  const result = await sevenStationsOrchestrator.runSevenStationsPipeline(
    scriptId,
    content,
    {
      useBackgroundAgent: true, // استخدام Background Worker
      timeout: 60000,
    }
  );
  
  return result;
}
```

## التحقق من الحالة

```tsx
import { backgroundWorkersInitializer } from "@/workers/initializer";

// التحقق من جاهزية النظام
const isReady = backgroundWorkersInitializer.isPipelineAgentReady();
console.log("هل النظام جاهز؟", isReady);

// الحصول على الحالة الكاملة
const status = backgroundWorkersInitializer.getStatus();
console.log("حالة العمال:", status);
```

## معالجة الأخطاء

```tsx
const { analyzeScript, error } = useScriptAnalysis();

try {
  await analyzeScript(id, content);
} catch (err) {
  console.error("خطأ في التحليل:", err);
  // معالجة الخطأ
}

// أو استخدام error من الحالة
if (error) {
  console.error("خطأ:", error);
}
```

## الإلغاء

```tsx
const { analyzeScript, cancelAnalysis, result } = useScriptAnalysis();

// بدء التحليل
await analyzeScript(id, content);

// إلغاء التحليل
if (result?.id) {
  cancelAnalysis(result.id);
}
```

## الخيارات المتقدمة

```tsx
await analyzeScript(scriptId, content, {
  // تخطي محطات معينة
  skipStations: ["station-1", "station-3"],
  
  // إعطاء أولوية لمحطات
  priorityStations: ["station-2", "station-4"],
  
  // المهلة الزمنية (بالميلي ثانية)
  timeout: 180000, // 3 دقائق
  
  // تعطيل Background Agent (للاختبار)
  useBackgroundAgent: false,
});
```

## نصائح الأداء

### ✅ افعل:
- استخدم `useBackgroundAgent: true` للسكربتات الكبيرة
- راقب `progress` لعرض التقدم للمستخدم
- امنح timeout كافي حسب حجم السكربت
- استخدم `skipStations` لتقليل وقت التحليل

### ❌ لا تفعل:
- لا تحجب الواجهة انتظاراً للنتائج
- لا تنسَ معالجة الأخطاء
- لا تبدأ تحاليل متعددة بنفس الوقت (قيد التطوير)
- لا تستخدم timeout قصير جداً

## استكشاف الأخطاء

### المشكلة: "Worker not initialized"
```tsx
// تأكد من تفعيل BackgroundWorkersProvider
// تحقق من Console للرسائل
```

### المشكلة: التحليل يتجمد
```tsx
// تحقق من timeout
// جرب تعطيل useBackgroundAgent مؤقتاً
// تحقق من حجم السكربت
```

### المشكلة: لا توجد نتائج
```tsx
// تحقق من return value
// راقب error state
// تحقق من Console logs
```

## الدعم

للمزيد من المعلومات، راجع:
- `تقرير_تنفيذ_الوكيل_الخلفي.md` (التقرير الكامل بالعربي)
- `BACKGROUND_AGENT_IMPLEMENTATION.md` (التقرير الفني بالإنجليزي)
